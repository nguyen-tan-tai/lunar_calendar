#ifndef alvn_h
#define alvn_h
#include <Arduino.h>

class LunarDate {
  public:
    int y;
    byte m;
    byte d;
    bool isLeapMon;
    String formatYyyyMmDd();
    LunarDate(int y, byte m, byte d, bool isLeapMon);
};

class YearlyMetaData {
  public:
    int y;
    byte lunarNewYearGregorianDay; // 1-31
    byte lunarNewYearGregorianMonth; // 1 -> Jan | 2 -> Feb
    byte lunarLeapMonth; // 1 - 12 for leap year | 0 for non leap year
    byte lunarDaysOfMonth[13];
    YearlyMetaData(int y);
};


class GregorianDate {
  public:
    int y;
    byte m;
    byte d;
    LunarDate toLunarDate();
    String formatYyyyMmDd();
    byte getDaysOfMonth(int y, byte m);
    GregorianDate(int y, byte m, byte d);

  private:
    LunarDate toLunarDate1(YearlyMetaData data);
    LunarDate toLunarDate2(YearlyMetaData data);
};

/*
  Luu am lich 3byte/nam
  byte1:    [Ngay bat dau 1/1 AL - 5 bit][thang bat dau 1/1 AL - 1 bit][So ngay thang nhuan - 1 bit]
  byte2:    [Thang nhuan - 4 bit][so ngay thang 12,11,10,9 - 4bit]
  byte3:    [So ngay thang 8,7,6,5,4,3,2,1 - 8bit]

  Ngay bat dau 1/1 AL  :  0x01->0x1F    1-31
  thang bat dau 1/1 AL :
  0             Thang 1
  1             Thang 2
  So ngay trong thang  :
  0             29 ngay
  1             30 ngay
*/
#define ROOTYEAR 2020 // The first year of YEARLY_META_DATA
const byte YEARLY_META_DATA[100][3] = {
  {B11001000, B01001100, B10011110}, //2020
  {B01100100, B00000101, B01010110}, //2021
  {B00001100, B00001010, B10110101}, //2022
  {B10110000, B00101010, B11011010}, //2023
  {B01010100, B00000110, B11010010}, //2024
  {B11101000, B01100111, B01100101}, //2025
  {B10001100, B00000111, B00100101}, //2026
  {B00110100, B00000110, B01001011}, //2027
  {B11010000, B01010110, B01010111}, //2028
  {B01101100, B00000100, B10101011}, //2029
  {B00010100, B00000101, B01011011}, //2030
  {B10111010, B00110101, B01101010}, //2031
  {B01011100, B00001011, B01101010}, //2032
  {B11111000, B10111111, B01010010}, //2033
  {B10011100, B00001011, B10010010}, //2034
  {B01000100, B00001011, B00100101}, //2035
  {B11100010, B01101101, B00001011}, //2036
  {B01111100, B00001010, B01001101}, //2037
  {B00100100, B00000100, B10101101}, //2038
  {B11000000, B01010100, B10111011}, //2039
  {B01100100, B00000101, B10101101}, //2040
  {B00001100, B00001011, B10101010}, //2041
  {B10110000, B00101101, B10101010}, //2042
  {B01010100, B00001101, B10010010}, //2043
  {B11110000, B01111110, B10100101}, //2044
  {B10001100, B00001101, B00100101}, //2045
  {B00110100, B00001010, B01010101}, //2046
  {B11010010, B01011010, B01001101}, //2047
  {B01110100, B00000100, B10110110}, //2048
  {B00010100, B00000110, B10110101}, //2049
  {B10111010, B00110110, B11010010}, //2050
  {B01011100, B00001110, B11001010}, //2051
  {B00001100, B10000111, B10010010}, //2052
  {B10010100, B00001110, B10010011}, //2053
  {B01000100, B00001101, B00101010}, //2054
  {B11100010, B01100101, B00010110}, //2055
  {B01111100, B00001010, B01011011}, //2056
  {B00100100, B00000101, B01011010}, //2057
  {B11000010, B01000101, B01100101}, //2058
  {B01100100, B00001011, B01010101}, //2059
  {B00010100, B00000111, B01001010}, //2060
  {B10101000, B00110111, B01001011}, //2061
  {B01001100, B00001010, B10010011}, //2062
  {B11101000, B01111010, B10101011}, //2063
  {B10001100, B00000101, B00101011}, //2064
  {B00101100, B00001010, B10011011}, //2065
  {B11010000, B01011010, B10111010}, //2066
  {B01110100, B00000101, B01101010}, //2067
  {B00011100, B00001011, B01100101}, //2068
  {B10111000, B01001011, B10101010}, //2069
  {B01011100, B00001101, B01001010}, //2070
  {B11111000, B10001101, B10010101}, //2071
  {B10011100, B00001100, B10010101}, //2072
  {B00111100, B00001001, B00101101}, //2073
  {B11011000, B01100101, B01101101}, //2074
  {B01111100, B00001010, B10110101}, //2075
  {B00101100, B00000101, B10101010}, //2076
  {B11000000, B01000110, B11010101}, //2077
  {B01100100, B00001110, B10100101}, //2078
  {B00010100, B00001101, B01001010}, //2079
  {B10110000, B00111110, B10001101}, //2080
  {B01001100, B00001100, B10010110}, //2081
  {B11101000, B01111100, B11010110}, //2082
  {B10001100, B00000101, B01010110}, //2083
  {B00110100, B00001010, B10110101}, //2084
  {B11010010, B01011011, B01010100}, //2085
  {B01110100, B00000110, B11010100}, //2086
  {B00011100, B00001110, B10100101}, //2087
  {B11000000, B01000111, B01001010}, //2088
  {B01010100, B00000110, B10001011}, //2089
  {B11110000, B10001010, B10010111}, //2090
  {B10010100, B00000100, B10101011}, //2091
  {B00111100, B00001001, B01011011}, //2092
  {B11011010, B01100101, B01011010}, //2093
  {B01111100, B00001011, B01101010}, //2094
  {B00101100, B00000111, B01010100}, //2095
  {B11001000, B01001011, B10010101}, //2096
  {B01100100, B00001011, B01000101}, //2097
  {B00001100, B00001010, B10001011}, //2098
  {B10101000, B00101010, B10010111}, //2099
};
#endif
